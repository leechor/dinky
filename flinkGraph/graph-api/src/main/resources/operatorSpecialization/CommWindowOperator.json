{
	"type": "object",
	"title": "CommWindowOperator",
	"description": "基础转换算子，将输入数据转换为一个新视图",
	"format": "categories",
	"basicCategoryTitle": "service",
	"properties": {
		"service": {
			"properties": {
				"tableName": {
					"type": "string",
					"title": "tableName",
					"description": "表名称，若为空将随机生成"
				},
				"orderBy": {
					"type": "array",
					"description": "指定字段升序或降序",
					"items": {
						"type": "object",
						"title": "orderBy",
						"required": [
							"order",
							"sort"
						],
						"properties": {
							"order": {
								"description": "字段名称",
								"pattern": "^[A-Za-z0-9_]*$",
								"type": "string",
								"format": "autoinput",
								"autoinput": {
									"name": "my-autoComplete",
									"function": {
										"name": "getFieldsByConfig"
									}
								}
							},
							"sort": {
								"type": "string",
								"description": "排序规则",
								"enum": [
									"ACS",
									"DESC"
								]
							}
						}
					}
				},
				"where": {
					"description": "过滤条件",
					"type": "string"
				},
				"limit": {
					"type": "array",
					"description": "分页",
					"maxItems": 2,
					"items": {
						"type": "string",
						"pattern": "^[A-Za-z0-9_]*$",
						"minLength": 1
					}
				},
				"group": {
					"anyOf": [
						{
							"title": "none",
							"description": "不分组",
							"type": "null"
						},
						{
							"title": "GROUP",
							"type": "object",
							"description": "指定字段名称分组",
							"properties": {
								"aggregation": {
									"type": "string",
									"minLength": 1,
									"enum": [
										"group"
									]
								},
								"column": {
									"type": "string",
									"pattern": "^[A-Za-z0-9_]*$",
									"minLength": 1,
									"format": "autoinput",
									"autoinput": {
										"name": "my-autoComplete",
										"function": {
											"name": "getFieldsByConfig"
										}
									}
								}
							},
							"additionalProperties": false
						},
						{
							"title": "WINDOWS_GROUP",
							"type": "object",
							"description": "窗口聚合",
							"properties": {
								"aggregation": {
									"type": "string",
									"minLength": 1,
									"enum": [
										"windowGroup"
									]
								},
								"windowsStart": {
									"type": "string",
									"description": "窗口开始时间",
									"minLength": 1
								},
								"windowEnd": {
									"type": "string",
									"description": "窗口结束时间",
									"minLength": 1
								}
							},
							"additionalProperties": false
						}
					]
				},
				"window": {
					"anyOf": [
						{
							"title": "none",
							"description": "无开窗操作",
							"type": "null"
						},
						{
							"title": "TUMBLE",
							"type": "object",
							"description": "滚动窗口 TUMBLE",
							"properties": {
								"windowFunction": {
									"type": "string",
									"enum": [
										"TUMBLE"
									]
								},
								"table": {
									"type": "string",
									"pattern": "^[A-Za-z0-9_]*$",
									"description": "需要查询的表名称",
									"enum": [
										"current table"
									]
								},
								"descriptor": {
									"type": "string",
									"pattern": "^[A-Za-z0-9_]*$",
									"description": "时间列名称，需要时间属性字段",
									"minLength": 1,
									"format": "autoinput",
									"autoinput": {
										"name": "my-autoComplete",
										"function": {
											"name": "getFieldsByConfig"
										}
									}
								},
								"size": {
									"type": "object",
									"description": "窗口大小定义",
									"properties": {
										"timeSpan": {
											"type": "integer",
											"description": "窗口持续时间",
											"minimum": 0,
											"default": 10
										},
										"timeUnit": {
											"type": "string",
											"description": "时间单位",
											"enum": [
												"SECOND",
												"MINUTE",
												"DAY",
												"MONTH",
												"YEAR"
											]
										}
									}
								}
							},
							"additionalProperties": false
						},
						{
							"title": "HOP",
							"type": "object",
							"description": "滑动窗口 HOP",
							"properties": {
								"windowFunction": {
									"type": "string",
									"enum": [
										"HOP"
									]
								},
								"table": {
									"type": "string",
									"pattern": "^[A-Za-z0-9_]*$",
									"description": "需要查询的表名称",
									"enum": [
										"current table"
									]
								},
								"descriptor": {
									"type": "string",
									"pattern": "^[A-Za-z0-9_]*$",
									"description": "时间列名称，需要时间属性字段",
									"minLength": 1,
									"format": "autoinput",
									"autoinput": {
										"name": "my-autoComplete",
										"function": {
											"name": "getFieldsByConfig"
										}
									}
								},
								"slide": {
									"type": "object",
									"description": "窗口滑动定义",
									"properties": {
										"timeSpan": {
											"type": "integer",
											"description": "窗口滑动步伐",
											"minimum": 0,
											"default": 10
										},
										"timeUnit": {
											"type": "string",
											"description": "时间单位",
											"enum": [
												"SECOND",
												"MINUTE",
												"DAY",
												"MONTH",
												"YEAR"
											]
										}
									}
								},
								"size": {
									"type": "object",
									"description": "窗口大小定义",
									"properties": {
										"timeSpan": {
											"type": "integer",
											"description": "窗口持续时间",
											"minimum": 0,
											"default": 10
										},
										"timeUnit": {
											"type": "string",
											"description": "时间单位",
											"enum": [
												"SECOND",
												"MINUTE",
												"DAY",
												"MONTH",
												"YEAR"
											]
										}
									}
								}
							},
							"additionalProperties": false
						},
						{
							"title": "CUMULATE",
							"description": "累积窗口 CUMULATE",
							"type": "object",
							"properties": {
								"windowFunction": {
									"type": "string",
									"enum": [
										"CUMULATE"
									]
								},
								"table": {
									"type": "string",
									"description": "需要查询的表名称",
									"enum": [
										"current table"
									]
								},
								"descriptor": {
									"type": "string",
									"pattern": "^[A-Za-z0-9_]*$",
									"description": "时间列名称，需要时间属性字段",
									"minLength": 1,
									"format": "autoinput",
									"autoinput": {
										"name": "my-autoComplete",
										"function": {
											"name": "getFieldsByConfig"
										}
									}
								},
								"step": {
									"type": "object",
									"description": "窗口步长定义",
									"properties": {
										"timeSpan": {
											"type": "integer",
											"description": "窗口步长定义",
											"minimum": 0,
											"default": 10
										},
										"timeUnit": {
											"type": "string",
											"description": "时间单位",
											"enum": [
												"SECOND",
												"MINUTE",
												"DAY",
												"MONTH",
												"YEAR"
											]
										}
									}
								},
								"size": {
									"type": "object",
									"description": "窗口大小定义",
									"properties": {
										"timeSpan": {
											"type": "integer",
											"description": "窗口持续时间",
											"minimum": 0,
											"default": 10
										},
										"timeUnit": {
											"type": "string",
											"description": "时间单位",
											"enum": [
												"SECOND",
												"MINUTE",
												"DAY",
												"MONTH",
												"YEAR"
											]
										}
									}
								}
							},
							"additionalProperties": false
						}
					]
				},
				"options": {
					"type": "object",
					"description": "SQL hints 动态表选项(OPTIONS)*",
					"properties": {
						"key": {
							"type": "string",
							"pattern": "^[A-Za-z0-9-_.]*$"
						},
						"val": {
							"pattern": "^[A-Za-z0-9-_.]*$",
							"type": "string"
						}
					}
				}
			}
		},
		"output": {
			"type": "object",
			"properties": {
				"columns": {
					"type": "array",
					"title": "mapping",
					"items": {
						"type": "object",
						"title": "columns",
						"properties": {
							"outName": {
								"type": "string",
								"pattern": "^[A-Za-z0-9_]*$",
								"title": "outName"
							},
							"name": {
								"type": "string",
								"title": "name",
								"description": "字段名称"
							},
							"function": {
								"title": "function",
								"description": "前端传递该结构至后端，后端返回嵌套结果，前端将结果存放在name字段中",
								"$ref": "#/function"
							},
							"type": {
								"type": "string",
								"minLength": 1,
								"title": "type",
								"default": "STRING",
								"enum": [
									"CHAR",
									"VARCHAR",
									"STRING",
									"BOOLEAN",
									"BINARY",
									"VARBINARY",
									"BYTES",
									"DECIMAL",
									"TINYINT",
									"SMALLINT",
									"INT",
									"BIGINT",
									"FLOAT",
									"DOUBLE",
									"DATE",
									"TIME",
									"TIMESTAMP",
									"TIMESTAMP(3)",
									"TIMESTAMP_LTZ(3)",
									"INTERVAL",
									"ARRAY",
									"MULTISET",
									"MAP",
									"ROW",
									"RAW"
								]
							},
							"desc": {
								"type": "string",
								"description": "备注"
							}
						}
					}
				},
				"source": {
					"type": "array",
					"title": "source",
					"items": {
						"type": "object",
						"title": "schema",
						"properties": {
							"name": {
								"type": "string",
								"minLength": 1,
								"pattern": "^[A-Za-z0-9_]*$",
								"title": "name",
								"description": "field name"
							},
							"type": {
								"type": "string",
								"minLength": 1,
								"title": "type",
								"default": "STRING",
								"enum": [
									"CHAR",
									"VARCHAR",
									"STRING",
									"BOOLEAN",
									"BINARY",
									"VARBINARY",
									"BYTES",
									"DECIMAL",
									"TINYINT",
									"SMALLINT",
									"INT",
									"BIGINT",
									"FLOAT",
									"DOUBLE",
									"DATE",
									"TIME",
									"TIMESTAMP",
									"TIMESTAMP(3)",
									"TIMESTAMP_LTZ(3)",
									"INTERVAL",
									"ARRAY",
									"MULTISET",
									"MAP",
									"ROW",
									"RAW"
								]
							},
							"desc": {
								"type": "string",
								"description": "备注"
							}
						}
					}
				}
			}
		}
	},
	"function": {
		"type": "array",
		"items": {
			"type": "object",
			"title": "_",
			"properties": {
				"functionName": {
					"type": "string",
					"title": "functionName",
					"format": "autoinput",
					"autoinput": {
						"name": "my-autoComplete",
						"function": {
							"name": "getFieldsByFunction"
						}
					}
				},
				"recursionFunc": {
					"title": "function",
					"$ref": "#/function"
				},
				"recursionName": {
					"title": "name",
					"$ref": "#/name"
				}
			}
		}
	},
	"name": {
		"type": "array",
		"items": {
			"title": "_",
			"type": "object",
			"properties": {
				"name": {
					"type": "array",
					"items": {
						"title": "_",
						"type": "string"
					}
				},
				"recursionFunc": {
					"title": "function",
					"$ref": "#/function"
				},
				"recursionName": {
					"title": "name",
					"$ref": "#/name"
				}
			}
		}
	}
}